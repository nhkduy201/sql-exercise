--PHAN TRUY VAN O SAU
--PHAN TAO CO SO DU LIEU, TAO BANG VA NHAP LIEU NEN EM COMMENT LAI

-- CREATE DATABASE QLCB
-- USE QLCB
-- GO
-- CREATE TABLE KHACHHANG
-- (
-- 	MAKH CHAR(15) PRIMARY KEY,
-- 	TEN NVARCHAR(15),
-- 	DCHI NVARCHAR(50),
-- 	DTHOAI CHAR(12)
-- )
-- CREATE TABLE NHANVIEN
-- (
-- 	MANV CHAR(15) PRIMARY KEY,
-- 	TEN NVARCHAR(15),
-- 	DCHI NVARCHAR(50),
-- 	DTHOAI CHAR(12),
-- 	LUONG NUMERIC(10,2),
-- 	LOAINV BIT
-- )
-- CREATE TABLE LOAIMB
-- (
-- 	MALOAI CHAR(15) PRIMARY KEY,
-- 	HANGSX CHAR(15)
-- )
-- CREATE TABLE MAYBAY
-- (
-- 	SOHIEU INT,
-- 	MALOAI CHAR(15),
-- 	PRIMARY KEY(SOHIEU, MALOAI)
-- )
-- CREATE TABLE CHUYENBAY
-- (
-- 	MACB CHAR(4) PRIMARY KEY,
-- 	SBDI CHAR(3),
-- 	SBDEN CHAR(3),
-- 	GIODI TIME,
-- 	GIODEN TIME
-- )
-- CREATE TABLE LICHBAY
-- (
-- 	NGAYDI DATETIME,
-- 	MACB CHAR(4),
-- 	SOHIEU INT,
-- 	MALOAI CHAR(15),
-- 	PRIMARY KEY(MACB, NGAYDI)
-- )
-- CREATE TABLE DATCHO
-- (
-- 	MAKH CHAR(15),
-- 	NGAYDI DATETIME,
-- 	MACB CHAR(4),
-- 	PRIMARY KEY(MAKH, NGAYDI, MACB)
-- )
-- CREATE TABLE KHANANG
-- (
-- 	MANV CHAR(15),
-- 	MALOAI CHAR(15),
-- 	PRIMARY KEY(MANV, MALOAI)
-- )
-- CREATE TABLE PHANCONG
-- (
-- 	MANV CHAR(15),
-- 	NGAYDI DATETIME,
-- 	MACB CHAR(4),
-- 	PRIMARY KEY(MANV, NGAYDI, MACB)
-- )

-- ALTER TABLE DATCHO
-- ADD CONSTRAINT FK_DATCHO_KHACHHANG
-- FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)

-- ALTER TABLE DATCHO
-- ADD CONSTRAINT FK_DATCHO_LICHBAY
-- FOREIGN KEY (NGAYDI, MACB) REFERENCES LICHBAY(NGAYDI, MACB)

-- ALTER TABLE LICHBAY
-- ADD CONSTRAINT FK_LICHBAY_CHUYENBAY
-- FOREIGN KEY (MACB) REFERENCES CHUYENBAY(MACB)

-- ALTER TABLE LICHBAY
-- ADD CONSTRAINT FK_LICHBAY_MAYBAY
-- FOREIGN KEY (SOHIEU, MALOAI) REFERENCES MAYBAY(SOHIEU, MALOAI)

-- ALTER TABLE MAYBAY
-- ADD CONSTRAINT FK_MAYBAY_LOAIMB
-- FOREIGN KEY (MALOAI) REFERENCES LOAIMB(MALOAI)

-- ALTER TABLE KHANANG
-- ADD CONSTRAINT FK_KHANANG_LOAIMB
-- FOREIGN KEY (MALOAI) REFERENCES LOAIMB(MALOAI)

-- ALTER TABLE KHANANG
-- ADD CONSTRAINT FK_KHANANG_NHANVIEN
-- FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

-- ALTER TABLE PHANCONG
-- ADD CONSTRAINT FK_PHANCONG_NHANVIEN
-- FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

-- ALTER TABLE PHANCONG
-- ADD CONSTRAINT FK_PHANCONG_LICHBAY
-- FOREIGN KEY (NGAYDI, MACB) REFERENCES LICHBAY(NGAYDI, MACB)

-- INSERT LOAIMB
-- 	(HANGSX, MALOAI)
-- VALUES
-- 	('Airbus', 'A310'),
-- 	('Airbus', 'A320'),
-- 	('Airbus', 'A330'),
-- 	('Airbus', 'A340'),
-- 	('Boeing', 'B727'),
-- 	('Boeing', 'B747'),
-- 	('Boeing', 'B757'),
-- 	('MD', 'DC10'),
-- 	('MD', 'DC9')

-- INSERT NHANVIEN
-- 	(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
-- VALUES
-- 	('1006', 'Chi', '12/6 Nguyen Kiem', '8120012', 150000, 0),
-- 	('1005', 'Giao', '65 Nguyen Thai Son', '8324467', 500000, 0),
-- 	('1001', 'Huong', '8 Dien Bien Phu', '8330733', 500000, 1),
-- 	('1002', 'Phong', '1 Ly Thuong Kiet', '8308117', 450000, 1),
-- 	('1004', 'Phuong', '351 Lac Long Quan', '8308155', 250000, 0),
-- 	('1003', 'Quang', '78 Truong Dinh', '8324461', 350000, 1),
-- 	('1007', 'Tam', '36 Nguyen Van Cu', '8458188', 500000, 0)
-- INSERT CHUYENBAY
-- 	(MACB, SBDI, SBDEN, GIODI, GIODEN)
-- VALUES
-- 	('100', 'SLC', 'BOS', '08:00', '17:50'),
-- 	('112', 'DCA', 'DEN', '14:00', '18:07'),
-- 	('121', 'STL', 'SLC', '07:00', '09:13'),
-- 	('122', 'STL', 'YYV', '08:30', '10:19'),
-- 	('206', 'DFW', 'STL', '09:00', '11:40'),
-- 	('330', 'JFK', 'YYV', '16:00', '18:53'),
-- 	('334', 'ORD', 'MIA', '12:00', '14:14'),
-- 	('335', 'MIA', 'ORD', '15:00', '17:14'),
-- 	('336', 'ORD', 'MIA', '18:00', '20:14'),
-- 	('337', 'MIA', 'ORD', '20:30', '23:53'),
-- 	('394', 'DFW', 'MIA', '19:00', '21:30'),
-- 	('395', 'MIA', 'DFW', '21:00', '23:43'),
-- 	('449', 'CDG', 'DEN', '10:00', '19:29'),
-- 	('930', 'YYV', 'DCA', '13:00', '16:10'),
-- 	('931', 'DCA', 'YYV', '17:00', '18:10'),
-- 	('932', 'DCA', 'YYV', '18:00', '19:10'),
-- 	('991', 'BOS', 'ORD', '17:00', '18:22')
-- INSERT MAYBAY
-- 	(SOHIEU, MALOAI)
-- VALUES
-- 	(10, 'B747'),
-- 	(11, 'B727'),
-- 	(13, 'B727'),
-- 	(13, 'B747'),
-- 	(21, 'DC10'),
-- 	(21, 'DC9'),
-- 	(22, 'B757'),
-- 	(22, 'DC9'),
-- 	(23, 'DC9'),
-- 	(24, 'DC9'),
-- 	(70, 'A310'),
-- 	(80, 'A310'),
-- 	(93, 'B757')
-- INSERT LICHBAY
-- 	(NGAYDI, MACB, SOHIEU, MALOAI)
-- VALUES
-- 	('11/1/2000', '100', 80, 'A310'),
-- 	('11/1/2000', '112', 21, 'DC10'),
-- 	('11/1/2000', '206', 22, 'DC9'),
-- 	('11/1/2000', '334', 10, 'B747'),
-- 	('11/1/2000', '395', 23, 'DC9'),
-- 	('11/1/2000', '991', 22, 'B757'),
-- 	('11/1/2000', '337', 10, 'B747'),
-- 	('10/31/2000', '100', 11, 'B727'),
-- 	('10/31/2000', '112', 11, 'B727'),
-- 	('10/31/2000', '206', 13, 'B727'),
-- 	('10/31/2000', '334', 10, 'B747'),
-- 	('10/31/2000', '335', 10, 'B747'),
-- 	('10/31/2000', '337', 24, 'DC9'),
-- 	('10/31/2000', '449', 70, 'A310')
-- INSERT KHANANG
-- 	(MANV, MALOAI)
-- VALUES
-- 	('1001', 'B727'),
-- 	('1001', 'B747'),
-- 	('1001', 'DC10'),
-- 	('1001', 'DC9'),
-- 	('1002', 'A320'),
-- 	('1002', 'A340'),
-- 	('1002', 'B757'),
-- 	('1002', 'DC9'),
-- 	('1003', 'A310'),
-- 	('1003', 'DC9')
-- INSERT PHANCONG
-- 	(MANV, NGAYDI, MACB)
-- VALUES
-- 	('1001', '11/01/2000', '100'),
-- 	('1001', '10/31/2000', '100'),
-- 	('1002', '11/01/2000', '100'),
-- 	('1002', '10/31/2000', '100'),
-- 	('1003', '10/31/2000', '100'),
-- 	('1003', '10/31/2000', '337'),
-- 	('1004', '10/31/2000', '100'),
-- 	('1004', '10/31/2000', '337'),
-- 	('1005', '10/31/2000', '337'),
-- 	('1006', '11/01/2000', '991'),
-- 	('1006', '10/31/2000', '337'),
-- 	('1007', '11/01/2000', '112'),
-- 	('1007', '11/01/2000', '991'),
-- 	('1007', '10/31/2000', '206')
-- INSERT KHACHHANG
-- 	(MAKH, TEN, DCHI, DTHOAI)
-- VALUES
-- 	('0009', 'Nga', '223 Nguyen Trai', '8932320'),
-- 	('0101', 'Anh', '567 Tran Phu', '8826729'),
-- 	('0045', 'Thu', '285 Le Loi', '8932203'),
-- 	('0012', 'Ha', '435 Quang Trung', '8933232'),
-- 	('0238', 'Hung', '456 Pasteur', '8933232'),
-- 	('0397', 'Thanh', '234 Le Van Si', '8952943'),
-- 	('0582', 'Mai', '789 Nguyen Du', NULL),
-- 	('0934', 'Minh', '678 Le Lai', NULL),
-- 	('0091', 'Hai', '345 Hung Vuong', '8893223'),
-- 	('0314', 'Phuong', '395 Vo Van Tan', '8232320'),
-- 	('0613', 'Vu', '348 CMT8', '8343232'),
-- 	('0586', 'Son', '123 Bach Dang', '8556223'),
-- 	('0422', 'Tien', '75 Nguyen Thong', '8332222')
-- INSERT DATCHO
-- 	(MAKH, NGAYDI, MACB)
-- VALUES
-- 	('0009', '11/01/2000', '100'),
-- 	('0009', '10/31/2000', '449'),
-- 	('0045', '11/01/2000', '991'),
-- 	('0012', '10/31/2000', '206'),
-- 	('0238', '10/31/2000', '334'),
-- 	('0582', '11/01/2000', '991'),
-- 	('0091', '11/01/2000', '100'),
-- 	('0314', '10/31/2000', '449'),
-- 	('0613', '11/01/2000', '100'),
-- 	('0586', '11/01/2000', '991'),
-- 	('0586', '10/31/2000', '100'),
-- 	('0422', '10/31/2000', '449')

--PHAN TRUY VAN
--1
SELECT NV.MANV N'MÃ SỐ', NV.TEN N'TÊN PHI CÔNG', NV.DCHI N'ĐỊA CHỈ', NV.DTHOAI N'ĐIỆN THOẠI'
FROM NHANVIEN NV, KHANANG KN
WHERE NV.MANV = KN.MANV AND KN.MALOAI = 'B747'
--2
SELECT LB.MACB N'MÃ SỐ', LB.NGAYDI N'NGÀY ĐI'
FROM CHUYENBAY CB, LICHBAY LB
WHERE CB.MACB = LB.MACB AND datepart(hour, CB.GIODI) > 14 AND datepart(hour, CB.GIODI) < 18
--3
	SELECT NV.*
	FROM NHANVIEN NV, PHANCONG PC, CHUYENBAY CB
	WHERE NV.MANV = PC.MANV AND PC.MACB = CB.MACB AND CB.MACB = '100'
INTERSECT
	SELECT NV.*
	FROM NHANVIEN NV, PHANCONG PC, CHUYENBAY CB
	WHERE NV.MANV = PC.MANV AND PC.MACB = CB.MACB AND CB.SBDI = 'SLC'
--4
	SELECT LB.MALOAI N'MÃ LOẠI', LB.SOHIEU N'SỐ HIỆU'
	FROM CHUYENBAY CB, LICHBAY LB
	WHERE CB.MACB = LB.MACB AND CB.SBDI = 'MIA'
INTERSECT
	SELECT MB.MALOAI N'MÃ LOẠI', MB.SOHIEU N'SỐ HIỆU'
	FROM MAYBAY MB
--5
SELECT LB.MACB N'MÃ CHUYẾN BAY', LB.NGAYDI N'NGÀY ĐI', KH.TEN N'TÊN', KH.DCHI N'ĐỊA CHỈ', KH.DTHOAI N'ĐIỆN THOẠI'
FROM KHACHHANG KH, DATCHO DC, LICHBAY LB
WHERE KH.MAKH = DC.MAKH AND DC.MACB = LB.MACB AND DC.NGAYDI = LB.NGAYDI
ORDER BY LB.MACB ASC, LB.NGAYDI DESC
--6
SELECT LB.MACB N'MÃ CHUYẾN BAY', LB.NGAYDI N'NGÀY ĐI', NV.TEN N'TÊN', NV.DCHI N'ĐỊA CHỈ', NV.DTHOAI N'ĐIỆN THOẠI'
FROM NHANVIEN NV, LICHBAY LB, PHANCONG PC
WHERE NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND PC.NGAYDI = LB.NGAYDI
ORDER BY LB.MACB DESC, LB.NGAYDI ASC
--7
SELECT LB.MACB N'MÃ CHUYẾN BAY', LB.NGAYDI N'NGÀY ĐI', NV.MANV N'MÃ SỐ', NV.TEN N'TÊN'
FROM NHANVIEN NV, LICHBAY LB, PHANCONG PC, CHUYENBAY CB
WHERE NV.LOAINV = 1 AND NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND PC.NGAYDI = LB.NGAYDI AND LB.MACB = CB.MACB AND CB.SBDEN = 'ORD'
--8
SELECT LB.MACB N'MÃ CHUYẾN BAY', LB.NGAYDI N'NGÀY ĐI', NV.TEN N'TÊN'
FROM NHANVIEN NV, LICHBAY LB, PHANCONG PC
WHERE NV.LOAINV = 1 AND NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND PC.NGAYDI = LB.NGAYDI AND NV.MANV = '1001'
--9
SELECT LB.MACB N'MÃ CHUYẾN BAY', CB.SBDI N'SÂN BAY ĐI', CB.GIODI N'GIỜ ĐI', CB.GIODEN N'GIỜ ĐẾN', LB.NGAYDI N'NGÀY ĐI'
FROM LICHBAY LB, CHUYENBAY CB
WHERE LB.MACB = CB.MACB AND CB.SBDEN = 'DEN'
ORDER BY LB.NGAYDI DESC, CB.SBDI ASC
--10
SELECT NV.TEN N'TÊN', LMB.HANGSX N'HÃNG SẢN XUẤT', LMB.MALOAI N'LOẠI MÁY BAY'
FROM NHANVIEN NV, KHANANG KN, LOAIMB LMB
WHERE NV.MANV = KN.MANV AND KN.MALOAI = LMB.MALOAI
--11
SELECT NV.MANV N'MÃ SỐ', NV.TEN N'TÊN'
FROM NHANVIEN NV, PHANCONG PC, LICHBAY LB
WHERE NV.MANV = PC.MANV AND PC.NGAYDI = LB.NGAYDI AND PC.MACB = LB.MACB AND LB.MACB = '100' AND LB.NGAYDI = '11/01/2000'
--12
SELECT LB.MACB N'MÃ CHUYẾN BAY', NV.MANV N'MÃ NHÂN VIÊN', NV.TEN N'TÊN NHÂN VIÊN'
FROM NHANVIEN NV, CHUYENBAY CB, PHANCONG PC, LICHBAY LB
WHERE NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND PC.NGAYDI = LB.NGAYDI AND LB.MACB = CB.MACB AND LB.NGAYDI = '10/31/2000' AND CB.SBDI = 'MIA' AND CB.GIODI = '20:30:00'
--13
SELECT LB.MALOAI N'MÃ CHUYẾN BAY', MB.SOHIEU N'SỐ HIỆU', MB.MALOAI N'MÃ LOẠI', LMB.HANGSX N'HÃNG SẢN XUẤT'
FROM LICHBAY LB, NHANVIEN NV, PHANCONG PC, MAYBAY MB, LOAIMB LMB
WHERE NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND PC.NGAYDI = LB.NGAYDI AND NV.TEN = 'Quang' AND LB.MALOAI = MB.MALOAI AND LB.SOHIEU = MB.SOHIEU AND MB.MALOAI = LMB.MALOAI
--14
	SELECT NV.TEN N'TÊN'
	FROM NHANVIEN NV
EXCEPT
	SELECT NV.TEN N'TÊN'
	FROM NHANVIEN NV, PHANCONG PC
	WHERE NV.MANV = PC.MANV
--15
SELECT KH.TEN N'TÊN'
FROM KHACHHANG KH, DATCHO DC, LICHBAY LB, MAYBAY MB, LOAIMB LMB
WHERE KH.MAKH = DC.MAKH AND DC.NGAYDI = LB.NGAYDI AND DC.MACB = LB.MACB AND LB.SOHIEU = MB.SOHIEU AND LB.MALOAI = MB.MALOAI AND MB.MALOAI = LMB.MALOAI AND LMB.HANGSX = 'Boeing'
--16
	SELECT CB.MACB N'MÃ CHUYẾN BAY'
	FROM CHUYENBAY CB, LICHBAY LB
	WHERE CB.MACB = LB.MACB AND LB.SOHIEU = 10 AND LB.MALOAI = 'B747'
INTERSECT
	SELECT CB.MACB N'MÃ CHUYẾN BAY'
	FROM CHUYENBAY CB