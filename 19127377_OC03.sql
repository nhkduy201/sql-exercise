use QLDT
go
--SUA KIEU DU LIEU CAPQL TRONG BANG DETAI
DELETE FROM THAMGIADT
DELETE FROM CONGVIEC
DELETE FROM DETAI
ALTER TABLE DETAI
DROP COLUMN CAPQL
ALTER TABLE DETAI
ADD CAPQL NVARCHAR(10)
INSERT DETAI(MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES
	('001', N'HTTT QUẢN LÝ CÁC TRƯỜNG ĐH', N'ĐHQG', 20, '2007-10-20', '2008-10-20', 'QLGD', '002'),
	('002', N'HTTT QUẢN LÝ GIÁO VỤ CHO MỘT KHOA', N'TRƯỜNG', 20, '2000-10-12', '2001-10-12', 'QLGD', '002'),
	('003', N'NGHIÊN CỨU CHẾ TẠO SỢI NANO PLATIN', N'ĐHQG', 300, '2008-5-15', '2010-5-15', 'NCPT', '005'),
	('004', N'TẠO VẬT LIỆU SINH HỌC BẰNG MÀNG ỐI NGƯỜI', N'NHÀ NƯỚC', 100, '2007-1-1', '2009-12-31', 'NCPT', '004'),
	('005', N'ỨNG DỤNG HÓA HỌC XANH', N'TRƯỜNG', 200, '2003-10-10', '2004-12-10', N'ƯDCN', '007'),
	('006', N'NGHIÊN CỨU TẾ BÀO GỐC', N'NHÀ NƯỚC', 4000, '2006-10-20', '2009-10-20', 'NCPT', '004'),
	('007', N'HTTT QUẢN LÝ THƯ VIỆN Ở CÁC TRƯỜNG ĐH', N'TRƯỜNG', 20, '2009-5-10', '2010-5-10', 'QLGD', '001')
INSERT CONGVIEC(MADT, SOTT, TENCV, NGAYBD, NGAYKT)
VALUES
	('001', 1, N'KHỞI TẠO VÀ LẬP KẾ HOẠCH', '2007-10-20', '2008-12-20'),
	('001', 2, N'XÁC ĐỊNH YÊU CẦU', '2008-12-21', '2008-3-21'),
	('001', 3, N'PHÂN TÍCH HỆ THỐNG', '2008-3-22', '2008-5-22'),
	('001', 4, N'THIẾT KẾ HỆ THỐNG', '2008-5-23', '2008-6-23'),
	('001', 5, N'CÀI ĐẶT THỬ NGHIỆM', '2008-6-24', '2008-10-20'),
	('002', 1, N'KHỞI TẠO VÀ LẬP KẾ HOẠCH', '2009-5-10', '2009-7-10'),
	('002', 2, N'XÁC ĐỊNH YÊU CẦU', '2009-7-11', '2009-10-11'),
	('002', 3, N'PHÂN TÍCH HỆ THỐNG', '2009-10-12', '2009-12-20'),
	('002', 4, N'THIẾT KẾ HỆ THỐNG', '2009-12-21', '2010-3-22'),
	('002', 5, N'CÀI ĐẶT THỬ NGHIỆM', '2010-3-23', '2010-5-10'),
	('006', 1, N'LẤY MẪU', '2006-10-20', '2007-2-20'),
	('006', 2, N'NUÔI CẤY', '2007-2-21', '2008-8-21')
INSERT THAMGIADT(MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES
	('001', '002', 1, 0, NULL),
	('001', '002', 2, 2, NULL),
	('002', '001', 4, 2, N'ĐẠT'),
	('003', '001', 1, 1, N'ĐẠT'),
	('003', '001', 2, 0, N'ĐẠT'),
	('003', '001', 4, 1, N'ĐẠT'),
	('003', '002', 2, 0, NULL),
	('004', '006', 1, 0, N'ĐẠT'),
	('004', '006', 2, 1, N'ĐẠT'),
	('006', '006', 2, 1.5, N'ĐẠT'),
	('009', '002', 3, 0.5, NULL),
	('009', '002', 4, 1.5, NULL)
--1
SELECT GV.HOTEN N'HỌ TÊN', GV.LUONG N'LƯƠNG' 
FROM GIAOVIEN GV
WHERE GV.PHAI = N'NỮ'
--2
SELECT GV.HOTEN N'HỌ TÊN', GV.LUONG * 1.1 N'LƯƠNG'
FROM GIAOVIEN GV
--3
SELECT DISTINCT GV.MAGV N'MÃ'
FROM GIAOVIEN GV, BOMON BM
WHERE (GV.HOTEN LIKE N'NGUYỄN %' AND GV.LUONG > 2000) OR (GV.MAGV = BM.TRUONGBM AND YEAR(BM.NGAYNHANCHUC) > 1995)
--4
SELECT GV.HOTEN N'HỌ TÊN'
FROM GIAOVIEN GV, KHOA K, BOMON BM
WHERE GV.MABM = BM.MABM AND K.MAKHOA = BM.MAKHOA AND BM.MAKHOA = 'CNTT'
--5
SELECT BM.*, GV.*
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM	
--6
SELECT GV.*, BM.*
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MABM = BM.MABM
--7
SELECT DT.TENDT N'TÊN ĐỀ TÀI', GV.HOTEN N'GIÁO VIÊN CHỦ NHIỆM ĐỀ TÀI'
FROM DETAI DT, GIAOVIEN GV
WHERE DT.GVCNDT = GV.MAGV
--8
SELECT K.*, GV.*
FROM KHOA K, GIAOVIEN GV
WHERE GV.MAGV = K.TRUONGKHOA
--9
SELECT GV.*
FROM GIAOVIEN GV
WHERE GV.MABM = 'VS'
INTERSECT
SELECT GV.*
FROM GIAOVIEN GV, THAMGIADT TGDT
WHERE TGDT.MAGV = GV.MAGV AND TGDT.MADT = '006'
--10
SELECT DT.MADT N'MÃ ĐỀ TÀI', CD.TENCD N'TÊN CHỦ ĐỀ', GV.HOTEN N'CHỦ NHIỆM ĐỀ TÀI', GV.NGSINH N'NGÀY SINH', GV.DIACHI N'ĐỊA CHỈ'
FROM GIAOVIEN GV, DETAI DT, CHUDE CD
WHERE DT.CAPQL = N'NHÀ NƯỚC' AND GV.MAGV = DT.GVCNDT AND CD.MACD = DT.MACD
--11
SELECT GV.HOTEN N'HỌ TÊN GIÁO VIÊN', GVPT.HOTEN N'HỌ TÊN NGƯỜI PHỤ TRÁCH CHUYÊN MÔN TRỰC TIẾP'
FROM GIAOVIEN GV JOIN GIAOVIEN GVPT ON GV.MAGV = GVPT.GVQLCM
--12
SELECT GV.HOTEN N'HỌ TÊN'
FROM GIAOVIEN GV, GIAOVIEN GVPT
WHERE GV.GVQLCM = GVPT.MAGV AND GVPT.HOTEN = N'NGUYỄN THANH TÙNG'
--13
SELECT GV.HOTEN N'TÊN'
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM AND BM.TENBM = N'HỆ THỐNG THÔNG TIN'
--14
SELECT DISTINCT GV.HOTEN N'TÊN'
FROM GIAOVIEN GV, DETAI DT, CHUDE CD
WHERE GV.MAGV = DT.GVCNDT AND DT.MACD = CD.MACD AND CD.MACD = 'QLGD'
--15
SELECT CV.TENCV N'TÊN CÔNG VIỆC'
FROM CONGVIEC CV, DETAI DT
WHERE DT.TENDT = N'HTTT QUẢN LÝ CÁC TRƯỜNG ĐH' AND DT.MADT = CV.MADT AND MONTH(CV.NGAYBD) = 3
--16
SELECT GV.HOTEN N'HỌ TÊN GIÁO VIÊN', GVPT.HOTEN N'HỌ TÊN NGƯỜI QUẢN LÍ CHUYÊN MÔN'
FROM GIAOVIEN GV JOIN GIAOVIEN GVPT ON GV.GVQLCM = GVPT.MAGV
--17
SELECT *
FROM CONGVIEC CV
WHERE CV.NGAYBD >= '2007-1-1' AND CV.NGAYBD <= '2007-8-1'
--18
SELECT GVCBM.*
FROM GIAOVIEN GV, GIAOVIEN GVCBM
WHERE GV.HOTEN = N'TRẦN TRÀ HƯƠNG' AND GV.MABM = GVCBM.MABM
EXCEPT
SELECT *
FROM GIAOVIEN GV
WHERE GV.HOTEN = N'TRẦN TRÀ HƯƠNG'
--19
--SELECT DISTINCT GV.*
--FROM GIAOVIEN GV, THAMGIADT TGDT, BOMON BM
--WHERE GV.MAGV = TGDT.MAGV AND GV.MAGV = BM.TRUONGBM
SELECT GV.*
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM
INTERSECT
SELECT GV.*
FROM GIAOVIEN GV, THAMGIADT TGDT
WHERE GV.MAGV = TGDT.MAGV
--20
--SELECT DISTINCT GV.*
--FROM GIAOVIEN GV, KHOA K, BOMON BM
--WHERE GV.MAGV = K.TRUONGKHOA AND GV.MAGV = BM.TRUONGBM
SELECT GV.*
FROM GIAOVIEN GV, KHOA K
WHERE GV.MAGV = K.TRUONGKHOA
INTERSECT
SELECT GV.*
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM
--21
--SELECT DISTINCT GV.HOTEN N'TÊN'
--FROM GIAOVIEN GV, THAMGIADT TGDT, BOMON BM
--WHERE GV.MAGV = BM.TRUONGBM AND GV.MAGV = TGDT.MAGV
SELECT GV.HOTEN N'TÊN'
FROM GIAOVIEN GV, THAMGIADT TGDT
WHERE GV.MAGV = TGDT.MAGV
INTERSECT
SELECT GV.HOTEN N'TÊN'
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM
--22
--SELECT DISTINCT GV.MAGV N'MÃ'
--FROM GIAOVIEN GV, THAMGIADT TGDT, KHOA K
--WHERE GV.MAGV = K.TRUONGKHOA AND GV.MAGV = TGDT.MAGV
SELECT GV.MAGV N'MÃ'
FROM GIAOVIEN GV, KHOA K
WHERE GV.MAGV = K.TRUONGKHOA
INTERSECT
SELECT GV.MAGV N'MÃ'
FROM GIAOVIEN GV, THAMGIADT TGDT
WHERE GV.MAGV = TGDT.MAGV
--23
--SELECT DISTINCT GV.*
--FROM GIAOVIEN GV, THAMGIADT TGDT
--WHERE GV.MABM = 'HTTT' AND GV.MAGV = TGDT.MAGV
SELECT *
FROM GIAOVIEN GV
WHERE GV.MABM = 'HTTT'
INTERSECT
SELECT GV.*
FROM GIAOVIEN GV, THAMGIADT TGDT
WHERE GV.MAGV = TGDT.MAGV
--24
SELECT GVCBM.*
FROM GIAOVIEN GV, GIAOVIEN GVCBM
WHERE GV.MAGV = '002' AND GVCBM.MABM = GV.MABM
EXCEPT
SELECT GV.*
FROM GIAOVIEN GV
WHERE GV.MAGV = '002'
--25
SELECT GV.*
FROM GIAOVIEN GV, BOMON BM
WHERE GV.MAGV = BM.TRUONGBM
--26
SELECT GV.HOTEN N'HỌ TÊN', GV.LUONG N'LƯƠNG'
FROM GIAOVIEN GV